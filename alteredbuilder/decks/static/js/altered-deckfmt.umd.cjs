(function(k,C){typeof exports=="object"&&typeof module<"u"?C(exports):typeof define=="function"&&define.amd?define(["exports"],C):(k=typeof globalThis<"u"?globalThis:k||self,C(k.deckfmt={}))})(this,function(k){"use strict";var ct=Object.defineProperty;var lt=(k,C,T)=>C in k?ct(k,C,{enumerable:!0,configurable:!0,writable:!0,value:T}):k[C]=T;var B=(k,C,T)=>lt(k,typeof C!="symbol"?C+"":C,T);var C=(p=>(p.Booster="B",p.Promo="P",p.AltArt="A",p))(C||{}),T=(p=>(p.Axiom="AX",p.Bravos="BR",p.Lyra="LY",p.Muna="MU",p.Ordis="OR",p.Yzmir="YZ",p.Neutral="NE",p))(T||{}),j=(p=>(p.Common="C",p.Rare="R1",p.RareOOF="R2",p.Unique="U",p))(j||{}),v=(p=>(p.CoreKS="COREKS",p.Core="CORE",p))(v||{});class fe{constructor(n){B(this,"set_code");B(this,"product");B(this,"faction");B(this,"num_in_faction");B(this,"rarity");B(this,"uniq_num");const o=n.match(/^ALT_(\w+)_(A|B|P)_(\w{2})_(\d{1,2})_(C|R1|R2|U)(?:_(\d+))?$/);if(!o)throw"unrecognized card id";if(this.set_code=o[1],this.product=o[2],this.faction=o[3],this.num_in_faction=parseInt(o[4],10),this.rarity=o[5],this.uniq_num=o[6]?parseInt(o[6]):void 0,this.rarity=="U"&&this.uniq_num==null)throw"unique card is missing a unique_number"}get productId(){switch(this.product){case"B":return null;case"P":return 1;case"A":return 2}}get factionId(){switch(this.faction){case"AX":return 1;case"BR":return 2;case"LY":return 3;case"MU":return 4;case"OR":return 5;case"YZ":return 6;case"NE":return 7}throw`Unrecognized Faction ${this.faction}`}get rarityId(){switch(this.rarity){case"C":return 0;case"R1":return 1;case"R2":return 2;case"U":return 3}throw`Unrecognized Rarity ${this.rarity}`}get setId(){switch(this.set_code){case"COREKS":return 1;case"CORE":return 2}throw`Unrecognized SetCode ${this.rarity}`}}class Y{constructor(){B(this,"setCode");B(this,"product");B(this,"faction");B(this,"numberInFaction");B(this,"rarity");B(this,"uniqueId")}static decode(n,o){const u=new Y;if(o.setCode===void 0)throw new W("Tried to decode Card without SetCode in context");if(u.setCode=o.setCode,n.readSync(1)==1)u.product=null;else if(u.product=n.readSync(2),u.product==0||u.product==3)throw new W(`Invalid product ID (${u.product})`);if(u.faction=n.readSync(3),u.faction==0)throw new W(`Invalid faction ID (${u.faction})`);return u.numberInFaction=n.readSync(5),u.rarity=n.readSync(2),u.rarity==3&&(u.uniqueId=n.readSync(16)),u}encode(n){if(this.product==null?n.write(1,1):(n.write(1,0),n.write(2,this.product)),n.write(3,this.faction),n.write(5,this.numberInFaction),n.write(2,this.rarity),this.uniqueId!==void 0){if(this.uniqueId>65535)throw new ee("Cannot encode unique ID greater than 65535");n.write(16,this.uniqueId)}}get asCardId(){let n="ALT_";switch(this.setCode){case 1:n+=v.CoreKS;break;case 2:n+=v.Core;break}switch(n+="_",this.product){case null:n+=C.Booster;break;case 1:n+=C.Promo;break;case 2:n+=C.AltArt;break}switch(n+="_",this.faction){case 1:n+=T.Axiom;break;case 2:n+=T.Bravos;break;case 3:n+=T.Lyra;break;case 4:n+=T.Muna;break;case 5:n+=T.Ordis;break;case 6:n+=T.Yzmir;break;case 7:n+=T.Neutral;break}switch(n+="_",this.numberInFaction<10&&this.faction!=7&&(n+="0"),n+=this.numberInFaction,n+="_",this.rarity){case 0:n+=j.Common;break;case 1:n+=j.Rare;break;case 2:n+=j.RareOOF;break;case 3:n+=j.Unique+"_"+this.uniqueId;break}return n}static fromId(n){let o=new Y,u=new fe(n);return o.setCode=u.setId,o.product=u.productId,o.faction=u.factionId,o.numberInFaction=u.num_in_faction,o.rarity=u.rarityId,o.uniqueId=u.uniq_num,o}}class Q{constructor(){B(this,"quantity");B(this,"card")}static decode(n,o){const u=new Q,a=n.readSync(2);if(a>0)u.quantity=a;else{const c=n.readSync(6);u.quantity=c==0?0:c+3}return u.card=Y.decode(n,o),u}encode(n){if(this.quantity>0&&this.quantity<=3)n.write(2,this.quantity);else if(this.quantity>3){if(this.quantity>65)throw new ee(`Cannot encode card quantity (${this.quantity}) greater than 65`);n.write(2,0),n.write(6,this.quantity-3)}else n.write(8,0);this.card.encode(n)}get asCardRefQty(){return{quantity:this.quantity,id:this.card.asCardId}}static from(n,o){let u=new Q;return u.quantity=n,u.card=Y.fromId(o),u}}class H{constructor(){B(this,"setCode");B(this,"cardQty")}static decode(n,o){const u=new H;if(u.setCode=n.readSync(8),u.setCode==0)throw new W(`Invalid SetCode ID (${u.setCode})`);o.setCode=u.setCode;const a=n.readSync(6),c=new Array;for(let d=0;d<a;d++)c.push(Q.decode(n,o));return u.cardQty=c,o.setCode=void 0,u}encode(n){if(this.cardQty.length<=0)throw new ee("Cannot encode a SetGroup with 0 cards");const o=this.cardQty[0].card.setCode;n.write(8,o),n.write(6,this.cardQty.length);for(let u of this.cardQty)u.encode(n)}static from(n){let o=new H;return o.cardQty=n.map(u=>Q.from(u.quantity,u.id)),o}}class P{constructor(){B(this,"version");B(this,"setGroups")}static decode(n){const o=new P,u=new Ue;if(o.version=n.readSync(4),o.version!==1)throw new W(`Invalid version (${o.version}`);const a=n.readSync(8),c=new Array;for(let d=0;d<a;d++)c.push(H.decode(n,u));return o.setGroups=c,o}encode(n){n.write(4,this.version),n.write(8,this.setGroups.length);for(let o of this.setGroups)o.encode(n);if(n.offset%8>0){const o=8-n.offset%8;n.write(o,0)}}get asCardRefQty(){return this.setGroups.reduce((n,o)=>n.concat(o.cardQty.map(u=>u.asCardRefQty)),Array())}static fromList(n){const o=P.groupedBySet(n).map(a=>H.from(a));let u=new P;return u.version=1,u.setGroups=o,u}static groupedBySet(n){let o=new Map;for(let u of n){const a=new fe(u.id).set_code;let c=o.get(a);c||(c=[],o.set(a,c)),c.push(u)}return Array.from(o,([u,a])=>a)}}class Ue{constructor(){B(this,"setCode")}}class W extends Error{constructor(n){super(n),this.name="DecodingError"}}class ee extends Error{constructor(n){super(n),this.name="EncodingError"}}var X={},K={};K.byteLength=ke,K.toByteArray=Le,K.fromByteArray=Me;for(var N=[],$=[],Ce=typeof Uint8Array<"u"?Uint8Array:Array,te="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",D=0,Re=te.length;D<Re;++D)N[D]=te[D],$[te.charCodeAt(D)]=D;$[45]=62,$[95]=63;function ue(p){var n=p.length;if(n%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var o=p.indexOf("=");o===-1&&(o=n);var u=o===n?0:4-o%4;return[o,u]}function ke(p){var n=ue(p),o=n[0],u=n[1];return(o+u)*3/4-u}function Te(p,n,o){return(n+o)*3/4-o}function Le(p){var n,o=ue(p),u=o[0],a=o[1],c=new Ce(Te(p,u,a)),d=0,y=a>0?u-4:u,f;for(f=0;f<y;f+=4)n=$[p.charCodeAt(f)]<<18|$[p.charCodeAt(f+1)]<<12|$[p.charCodeAt(f+2)]<<6|$[p.charCodeAt(f+3)],c[d++]=n>>16&255,c[d++]=n>>8&255,c[d++]=n&255;return a===2&&(n=$[p.charCodeAt(f)]<<2|$[p.charCodeAt(f+1)]>>4,c[d++]=n&255),a===1&&(n=$[p.charCodeAt(f)]<<10|$[p.charCodeAt(f+1)]<<4|$[p.charCodeAt(f+2)]>>2,c[d++]=n>>8&255,c[d++]=n&255),c}function $e(p){return N[p>>18&63]+N[p>>12&63]+N[p>>6&63]+N[p&63]}function Ne(p,n,o){for(var u,a=[],c=n;c<o;c+=3)u=(p[c]<<16&16711680)+(p[c+1]<<8&65280)+(p[c+2]&255),a.push($e(u));return a.join("")}function Me(p){for(var n,o=p.length,u=o%3,a=[],c=16383,d=0,y=o-u;d<y;d+=c)a.push(Ne(p,d,d+c>y?y:d+c));return u===1?(n=p[o-1],a.push(N[n>>2]+N[n<<4&63]+"==")):u===2&&(n=(p[o-2]<<8)+p[o-1],a.push(N[n>>10]+N[n>>4&63]+N[n<<2&63]+"=")),a.join("")}var re={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */re.read=function(p,n,o,u,a){var c,d,y=a*8-u-1,f=(1<<y)-1,x=f>>1,b=-7,I=o?a-1:0,E=o?-1:1,S=p[n+I];for(I+=E,c=S&(1<<-b)-1,S>>=-b,b+=y;b>0;c=c*256+p[n+I],I+=E,b-=8);for(d=c&(1<<-b)-1,c>>=-b,b+=u;b>0;d=d*256+p[n+I],I+=E,b-=8);if(c===0)c=1-x;else{if(c===f)return d?NaN:(S?-1:1)*(1/0);d=d+Math.pow(2,u),c=c-x}return(S?-1:1)*d*Math.pow(2,c-u)},re.write=function(p,n,o,u,a,c){var d,y,f,x=c*8-a-1,b=(1<<x)-1,I=b>>1,E=a===23?Math.pow(2,-24)-Math.pow(2,-77):0,S=u?0:c-1,F=u?1:-1,O=n<0||n===0&&1/n<0?1:0;for(n=Math.abs(n),isNaN(n)||n===1/0?(y=isNaN(n)?1:0,d=b):(d=Math.floor(Math.log(n)/Math.LN2),n*(f=Math.pow(2,-d))<1&&(d--,f*=2),d+I>=1?n+=E/f:n+=E*Math.pow(2,1-I),n*f>=2&&(d++,f/=2),d+I>=b?(y=0,d=b):d+I>=1?(y=(n*f-1)*Math.pow(2,a),d=d+I):(y=n*Math.pow(2,I-1)*Math.pow(2,a),d=0));a>=8;p[o+S]=y&255,S+=F,y/=256,a-=8);for(d=d<<a|y,x+=a;x>0;p[o+S]=d&255,S+=F,d/=256,x-=8);p[o+S-F]|=O*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(p){const n=K,o=re,u=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;p.Buffer=f,p.SlowBuffer=je,p.INSPECT_MAX_BYTES=50;const a=2147483647;p.kMaxLength=a;const c=(1<<28)-16;p.kStringMaxLength=c,p.constants={MAX_LENGTH:a,MAX_STRING_LENGTH:c},p.Blob=typeof Blob<"u"?Blob:void 0,p.File=typeof File<"u"?File:void 0,p.atob=typeof atob<"u"?atob:void 0,p.btoa=typeof btoa<"u"?btoa:void 0,f.TYPED_ARRAY_SUPPORT=d(),!f.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function d(){try{const r=new Uint8Array(1),e={foo:function(){return 42}};return Object.setPrototypeOf(e,Uint8Array.prototype),Object.setPrototypeOf(r,e),r.foo()===42}catch{return!1}}Object.defineProperty(f.prototype,"parent",{enumerable:!0,get:function(){if(f.isBuffer(this))return this.buffer}}),Object.defineProperty(f.prototype,"offset",{enumerable:!0,get:function(){if(f.isBuffer(this))return this.byteOffset}});function y(r){if(r>a)throw new RangeError('The value "'+r+'" is invalid for option "size"');const e=new Uint8Array(r);return Object.setPrototypeOf(e,f.prototype),e}function f(r,e,t){if(typeof r=="number"){if(typeof e=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return E(r)}return x(r,e,t)}f.poolSize=8192;function x(r,e,t){if(typeof r=="string")return S(r,e);if(ArrayBuffer.isView(r))return O(r);if(r==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof r);if(L(r,ArrayBuffer)||r&&L(r.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(L(r,SharedArrayBuffer)||r&&L(r.buffer,SharedArrayBuffer)))return ie(r,e,t);if(typeof r=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const i=r.valueOf&&r.valueOf();if(i!=null&&i!==r)return f.from(i,e,t);const s=ze(r);if(s)return s;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof r[Symbol.toPrimitive]=="function")return f.from(r[Symbol.toPrimitive]("string"),e,t);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof r)}f.from=function(r,e,t){return x(r,e,t)},Object.setPrototypeOf(f.prototype,Uint8Array.prototype),Object.setPrototypeOf(f,Uint8Array);function b(r){if(typeof r!="number")throw new TypeError('"size" argument must be of type number');if(r<0)throw new RangeError('The value "'+r+'" is invalid for option "size"')}function I(r,e,t){return b(r),r<=0?y(r):e!==void 0?typeof t=="string"?y(r).fill(e,t):y(r).fill(e):y(r)}f.alloc=function(r,e,t){return I(r,e,t)};function E(r){return b(r),y(r<0?0:ne(r)|0)}f.allocUnsafe=function(r){return E(r)},f.allocUnsafeSlow=function(r){return E(r)};function S(r,e){if((typeof e!="string"||e==="")&&(e="utf8"),!f.isEncoding(e))throw new TypeError("Unknown encoding: "+e);const t=he(r,e)|0;let i=y(t);const s=i.write(r,e);return s!==t&&(i=i.slice(0,s)),i}function F(r){const e=r.length<0?0:ne(r.length)|0,t=y(e);for(let i=0;i<e;i+=1)t[i]=r[i]&255;return t}function O(r){if(L(r,Uint8Array)){const e=new Uint8Array(r);return ie(e.buffer,e.byteOffset,e.byteLength)}return F(r)}function ie(r,e,t){if(e<0||r.byteLength<e)throw new RangeError('"offset" is outside of buffer bounds');if(r.byteLength<e+(t||0))throw new RangeError('"length" is outside of buffer bounds');let i;return e===void 0&&t===void 0?i=new Uint8Array(r):t===void 0?i=new Uint8Array(r,e):i=new Uint8Array(r,e,t),Object.setPrototypeOf(i,f.prototype),i}function ze(r){if(f.isBuffer(r)){const e=ne(r.length)|0,t=y(e);return t.length===0||r.copy(t,0,0,e),t}if(r.length!==void 0)return typeof r.length!="number"||Fe(r.length)?y(0):F(r);if(r.type==="Buffer"&&Array.isArray(r.data))return F(r.data)}function ne(r){if(r>=a)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+a.toString(16)+" bytes");return r|0}function je(r){return+r!=r&&(r=0),f.alloc(+r)}f.isBuffer=function(e){return e!=null&&e._isBuffer===!0&&e!==f.prototype},f.compare=function(e,t){if(!L(e,Uint8Array)||!L(t,Uint8Array))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;let i=e.length,s=t.length;for(let h=0,l=Math.min(i,s);h<l;++h)if(e[h]!==t[h]){i=e[h],s=t[h];break}return i<s?-1:s<i?1:0},f.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64url":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},f.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(e.length===0)return f.alloc(0);let i;if(t===void 0)for(t=0,i=0;i<e.length;++i)t+=e[i].length;const s=f.allocUnsafe(t);let h=0;for(i=0;i<e.length;++i){const l=e[i];if(!L(l,Uint8Array))throw new TypeError('"list" argument must be an Array of Buffers');if(h+l.length>s.length){s.set(l.subarray(0,s.length-h),h);break}s.set(l,h),h+=l.length}return s};function he(r,e){if(ArrayBuffer.isView(r)||L(r,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&L(r,SharedArrayBuffer))return r.byteLength;if(typeof r!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof r);const t=r.length,i=arguments.length>2&&arguments[2]===!0;if(!i&&t===0)return 0;let s=!1;for(;;)switch(e){case"ascii":case"latin1":case"binary":return t;case"utf8":case"utf-8":return oe(r).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return t*2;case"hex":return t>>>1;case"base64":return _e(r).length;default:if(s)return i?-1:oe(r).length;e=(""+e).toLowerCase(),s=!0}}f.byteLength=he;function Ye(r,e,t){let i=!1;if((e===void 0||e<0)&&(e=0),e>this.length||((t===void 0||t>this.length)&&(t=this.length),t<=0)||(t>>>=0,e>>>=0,t<=e))return"";for(r||(r="utf8");;)switch(r){case"hex":return et(this,e,t);case"utf8":case"utf-8":return le(this,e,t);case"ascii":return Ze(this,e,t);case"latin1":case"binary":return ve(this,e,t);case"base64url":case"base64":return Ke(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return tt(this,e,t);default:if(i)throw new TypeError("Unknown encoding: "+r);r=(r+"").toLowerCase(),i=!0}}f.prototype._isBuffer=!0;function q(r,e,t){const i=r[e];r[e]=r[t],r[t]=i}f.prototype.swap16=function(){const e=this.length;if(e%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let t=0;t<e;t+=2)q(this,t,t+1);return this},f.prototype.swap32=function(){const e=this.length;if(e%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let t=0;t<e;t+=4)q(this,t,t+3),q(this,t+1,t+2);return this},f.prototype.swap64=function(){const e=this.length;if(e%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let t=0;t<e;t+=8)q(this,t,t+7),q(this,t+1,t+6),q(this,t+2,t+5),q(this,t+3,t+4);return this},f.prototype.toString=function(){const e=this.length;return e===0?"":arguments.length===0?le(this,0,e):Ye.apply(this,arguments)},f.prototype.toLocaleString=f.prototype.toString,f.prototype.equals=function(e){return this===e?!0:f.compare(this,e)===0},f.prototype.inspect=function(){let e="";const t=p.INSPECT_MAX_BYTES;return e=this.toString("hex",0,t).replace(/(.{2})/g,"$1 ").trim(),this.length>t&&(e+=" ... "),"<Buffer "+e+">"},u&&(f.prototype[u]=f.prototype.inspect),f.prototype.compare=function(e,t,i,s,h){if(!L(e,Uint8Array))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(t===void 0&&(t=0),i===void 0&&(i=e?e.length:0),s===void 0&&(s=0),h===void 0&&(h=this.length),t<0||i>e.length||s<0||h>this.length)throw new RangeError("out of range index");if(s>=h&&t>=i)return 0;if(s>=h)return-1;if(t>=i)return 1;if(t>>>=0,i>>>=0,s>>>=0,h>>>=0,this===e)return 0;let l=h-s,w=i-t;const m=Math.min(l,w);for(let g=0;g<m;++g)if(this[s+g]!==e[t+g]){l=this[s+g],w=e[t+g];break}return l<w?-1:w<l?1:0};function ae(r,e,t,i,s){if(r.length===0)return-1;if(typeof t=="string"?(i=t,t=0):t>2147483647?t=2147483647:t<-2147483648&&(t=-2147483648),t=+t,Fe(t)&&(t=s?0:r.length-1),t<0&&(t=r.length+t),t>=r.length){if(s)return-1;t=r.length-1}else if(t<0)if(s)t=0;else return-1;if(typeof e=="string"&&(e=f.from(e,i)),f.isBuffer(e))return e.length===0?-1:ce(r,e,t,i,s);if(typeof e=="number")return e=e&255,typeof Uint8Array.prototype.indexOf=="function"?s?Uint8Array.prototype.indexOf.call(r,e,t):Uint8Array.prototype.lastIndexOf.call(r,e,t):ce(r,[e],t,i,s);throw new TypeError("val must be string, number or Buffer")}function ce(r,e,t,i,s){let h=1,l=r.length,w=e.length;if(i!==void 0&&(i=String(i).toLowerCase(),i==="ucs2"||i==="ucs-2"||i==="utf16le"||i==="utf-16le")){if(r.length<2||e.length<2)return-1;h=2,l/=2,w/=2,t/=2}function m(A,_){return h===1?A[_]:A.readUInt16BE(_*h)}let g;if(s){let A=-1;for(g=t;g<l;g++)if(m(r,g)===m(e,A===-1?0:g-A)){if(A===-1&&(A=g),g-A+1===w)return A*h}else A!==-1&&(g-=g-A),A=-1}else for(t+w>l&&(t=l-w),g=t;g>=0;g--){let A=!0;for(let _=0;_<w;_++)if(m(r,g+_)!==m(e,_)){A=!1;break}if(A)return g}return-1}f.prototype.includes=function(e,t,i){return this.indexOf(e,t,i)!==-1},f.prototype.indexOf=function(e,t,i){return ae(this,e,t,i,!0)},f.prototype.lastIndexOf=function(e,t,i){return ae(this,e,t,i,!1)};function Qe(r,e,t,i){t=Number(t)||0;const s=r.length-t;i?(i=Number(i),i>s&&(i=s)):i=s;const h=e.length;i>h>>>1&&(i=h>>>1);for(let l=0;l<i;++l){const w=e.charCodeAt(l*2+0),m=e.charCodeAt(l*2+1),g=Se[w&127],A=Se[m&127];if((w|m|g|A)&-128)return l;r[t+l]=g<<4|A}return i}function He(r,e,t,i){return Z(oe(e,r.length-t),r,t,i)}function We(r,e,t,i){return Z(ft(e),r,t,i)}function Ve(r,e,t,i,s){const h=s==="base64url"?nt(e):e;return Z(_e(h),r,t,i)}function Xe(r,e,t,i){return Z(ut(e,r.length-t),r,t,i)}f.prototype.write=function(e,t,i,s){if(t===void 0)s="utf8",i=this.length,t=0;else if(i===void 0&&typeof t=="string")s=t,i=this.length,t=0;else if(isFinite(t))t=t>>>0,isFinite(i)?(i=i>>>0,s===void 0&&(s="utf8")):(s=i,i=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const h=this.length-t;if((i===void 0||i>h)&&(i=h),e.length>0&&(i<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");s||(s="utf8");let l=!1;for(;;)switch(s){case"hex":return Qe(this,e,t,i);case"utf8":case"utf-8":return He(this,e,t,i);case"ascii":case"latin1":case"binary":return We(this,e,t,i);case"base64url":case"base64":return Ve(this,e,t,i,s);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Xe(this,e,t,i);default:if(l)throw new TypeError("Unknown encoding: "+s);s=(""+s).toLowerCase(),l=!0}},f.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this,0)}};function Ke(r,e,t,i){let s;return e===0&&t===r.length?s=n.fromByteArray(r):s=n.fromByteArray(r.slice(e,t)),i==="base64url"?st(s):s}function le(r,e,t){t=Math.min(r.length,t);const i=[];let s=e;for(;s<t;){const h=r[s];let l=null,w=h>239?4:h>223?3:h>191?2:1;if(s+w<=t){let m,g,A,_;switch(w){case 1:h<128&&(l=h);break;case 2:m=r[s+1],(m&192)===128&&(_=(h&31)<<6|m&63,_>127&&(l=_));break;case 3:m=r[s+1],g=r[s+2],(m&192)===128&&(g&192)===128&&(_=(h&15)<<12|(m&63)<<6|g&63,_>2047&&(_<55296||_>57343)&&(l=_));break;case 4:m=r[s+1],g=r[s+2],A=r[s+3],(m&192)===128&&(g&192)===128&&(A&192)===128&&(_=(h&15)<<18|(m&63)<<12|(g&63)<<6|A&63,_>65535&&_<1114112&&(l=_))}}l===null?(l=65533,w=1):l>65535&&(l-=65536,i.push(l>>>10&1023|55296),l=56320|l&1023),i.push(l),s+=w}return Je(i)}const de=4096;function Je(r){const e=r.length;if(e<=de)return String.fromCharCode.apply(String,r);let t="",i=0;for(;i<e;)t+=String.fromCharCode.apply(String,r.slice(i,i+=de));return t}function Ze(r,e,t){let i="";t=Math.min(r.length,t);for(let s=e;s<t;++s)i+=String.fromCharCode(r[s]&127);return i}function ve(r,e,t){let i="";t=Math.min(r.length,t);for(let s=e;s<t;++s)i+=String.fromCharCode(r[s]);return i}function et(r,e,t){const i=r.length;(!e||e<0)&&(e=0),(!t||t<0||t>i)&&(t=i);let s="";for(let h=e;h<t;++h)s+=ht[r[h]];return s}function tt(r,e,t){const i=r.slice(e,t);let s="";for(let h=0;h<i.length-1;h+=2)s+=String.fromCharCode(i[h]+i[h+1]*256);return s}f.prototype.slice=function(e,t){const i=this.length;e=~~e,t=t===void 0?i:~~t,e<0?(e+=i,e<0&&(e=0)):e>i&&(e=i),t<0?(t+=i,t<0&&(t=0)):t>i&&(t=i),t<e&&(t=e);const s=this.subarray(e,t);return Object.setPrototypeOf(s,f.prototype),s};function U(r,e,t){if(r%1!==0||r<0)throw new RangeError("offset is not uint");if(r+e>t)throw new RangeError("Trying to access beyond buffer length")}f.prototype.readUintLE=f.prototype.readUIntLE=function(e,t,i){e=e>>>0,t=t>>>0,i||U(e,t,this.length);let s=this[e],h=1,l=0;for(;++l<t&&(h*=256);)s+=this[e+l]*h;return s},f.prototype.readUintBE=f.prototype.readUIntBE=function(e,t,i){e=e>>>0,t=t>>>0,i||U(e,t,this.length);let s=this[e+--t],h=1;for(;t>0&&(h*=256);)s+=this[e+--t]*h;return s},f.prototype.readUint8=f.prototype.readUInt8=function(e,t){return e=e>>>0,t||U(e,1,this.length),this[e]},f.prototype.readUint16LE=f.prototype.readUInt16LE=function(e,t){return e=e>>>0,t||U(e,2,this.length),this[e]|this[e+1]<<8},f.prototype.readUint16BE=f.prototype.readUInt16BE=function(e,t){return e=e>>>0,t||U(e,2,this.length),this[e]<<8|this[e+1]},f.prototype.readUint32LE=f.prototype.readUInt32LE=function(e,t){return e=e>>>0,t||U(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+this[e+3]*16777216},f.prototype.readUint32BE=f.prototype.readUInt32BE=function(e,t){return e=e>>>0,t||U(e,4,this.length),this[e]*16777216+(this[e+1]<<16|this[e+2]<<8|this[e+3])},f.prototype.readBigUInt64LE=M(function(e){e=e>>>0,z(e,"offset");const t=this[e],i=this[e+7];(t===void 0||i===void 0)&&V(e,this.length-8);const s=t+this[++e]*2**8+this[++e]*2**16+this[++e]*2**24,h=this[++e]+this[++e]*2**8+this[++e]*2**16+i*2**24;return BigInt(s)+(BigInt(h)<<BigInt(32))}),f.prototype.readBigUInt64BE=M(function(e){e=e>>>0,z(e,"offset");const t=this[e],i=this[e+7];(t===void 0||i===void 0)&&V(e,this.length-8);const s=t*2**24+this[++e]*2**16+this[++e]*2**8+this[++e],h=this[++e]*2**24+this[++e]*2**16+this[++e]*2**8+i;return(BigInt(s)<<BigInt(32))+BigInt(h)}),f.prototype.readIntLE=function(e,t,i){e=e>>>0,t=t>>>0,i||U(e,t,this.length);let s=this[e],h=1,l=0;for(;++l<t&&(h*=256);)s+=this[e+l]*h;return h*=128,s>=h&&(s-=Math.pow(2,8*t)),s},f.prototype.readIntBE=function(e,t,i){e=e>>>0,t=t>>>0,i||U(e,t,this.length);let s=t,h=1,l=this[e+--s];for(;s>0&&(h*=256);)l+=this[e+--s]*h;return h*=128,l>=h&&(l-=Math.pow(2,8*t)),l},f.prototype.readInt8=function(e,t){return e=e>>>0,t||U(e,1,this.length),this[e]&128?(255-this[e]+1)*-1:this[e]},f.prototype.readInt16LE=function(e,t){e=e>>>0,t||U(e,2,this.length);const i=this[e]|this[e+1]<<8;return i&32768?i|4294901760:i},f.prototype.readInt16BE=function(e,t){e=e>>>0,t||U(e,2,this.length);const i=this[e+1]|this[e]<<8;return i&32768?i|4294901760:i},f.prototype.readInt32LE=function(e,t){return e=e>>>0,t||U(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},f.prototype.readInt32BE=function(e,t){return e=e>>>0,t||U(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},f.prototype.readBigInt64LE=M(function(e){e=e>>>0,z(e,"offset");const t=this[e],i=this[e+7];(t===void 0||i===void 0)&&V(e,this.length-8);const s=this[e+4]+this[e+5]*2**8+this[e+6]*2**16+(i<<24);return(BigInt(s)<<BigInt(32))+BigInt(t+this[++e]*2**8+this[++e]*2**16+this[++e]*2**24)}),f.prototype.readBigInt64BE=M(function(e){e=e>>>0,z(e,"offset");const t=this[e],i=this[e+7];(t===void 0||i===void 0)&&V(e,this.length-8);const s=(t<<24)+this[++e]*2**16+this[++e]*2**8+this[++e];return(BigInt(s)<<BigInt(32))+BigInt(this[++e]*2**24+this[++e]*2**16+this[++e]*2**8+i)}),f.prototype.readFloatLE=function(e,t){return e=e>>>0,t||U(e,4,this.length),o.read(this,e,!0,23,4)},f.prototype.readFloatBE=function(e,t){return e=e>>>0,t||U(e,4,this.length),o.read(this,e,!1,23,4)},f.prototype.readDoubleLE=function(e,t){return e=e>>>0,t||U(e,8,this.length),o.read(this,e,!0,52,8)},f.prototype.readDoubleBE=function(e,t){return e=e>>>0,t||U(e,8,this.length),o.read(this,e,!1,52,8)};function R(r,e,t,i,s,h){if(!f.isBuffer(r))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>s||e<h)throw new RangeError('"value" argument is out of bounds');if(t+i>r.length)throw new RangeError("Index out of range")}f.prototype.writeUintLE=f.prototype.writeUIntLE=function(e,t,i,s){if(e=+e,t=t>>>0,i=i>>>0,!s){const w=Math.pow(2,8*i)-1;R(this,e,t,i,w,0)}let h=1,l=0;for(this[t]=e&255;++l<i&&(h*=256);)this[t+l]=e/h&255;return t+i},f.prototype.writeUintBE=f.prototype.writeUIntBE=function(e,t,i,s){if(e=+e,t=t>>>0,i=i>>>0,!s){const w=Math.pow(2,8*i)-1;R(this,e,t,i,w,0)}let h=i-1,l=1;for(this[t+h]=e&255;--h>=0&&(l*=256);)this[t+h]=e/l&255;return t+i},f.prototype.writeUint8=f.prototype.writeUInt8=function(e,t,i){return e=+e,t=t>>>0,i||R(this,e,t,1,255,0),this[t]=e&255,t+1},f.prototype.writeUint16LE=f.prototype.writeUInt16LE=function(e,t,i){return e=+e,t=t>>>0,i||R(this,e,t,2,65535,0),this[t]=e&255,this[t+1]=e>>>8,t+2},f.prototype.writeUint16BE=f.prototype.writeUInt16BE=function(e,t,i){return e=+e,t=t>>>0,i||R(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=e&255,t+2},f.prototype.writeUint32LE=f.prototype.writeUInt32LE=function(e,t,i){return e=+e,t=t>>>0,i||R(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=e&255,t+4},f.prototype.writeUint32BE=f.prototype.writeUInt32BE=function(e,t,i){return e=+e,t=t>>>0,i||R(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=e&255,t+4};function pe(r,e,t,i,s){xe(e,i,s,r,t,7);let h=Number(e&BigInt(4294967295));r[t++]=h,h=h>>8,r[t++]=h,h=h>>8,r[t++]=h,h=h>>8,r[t++]=h;let l=Number(e>>BigInt(32)&BigInt(4294967295));return r[t++]=l,l=l>>8,r[t++]=l,l=l>>8,r[t++]=l,l=l>>8,r[t++]=l,t}function ye(r,e,t,i,s){xe(e,i,s,r,t,7);let h=Number(e&BigInt(4294967295));r[t+7]=h,h=h>>8,r[t+6]=h,h=h>>8,r[t+5]=h,h=h>>8,r[t+4]=h;let l=Number(e>>BigInt(32)&BigInt(4294967295));return r[t+3]=l,l=l>>8,r[t+2]=l,l=l>>8,r[t+1]=l,l=l>>8,r[t]=l,t+8}f.prototype.writeBigUInt64LE=M(function(e,t=0){return pe(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))}),f.prototype.writeBigUInt64BE=M(function(e,t=0){return ye(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))}),f.prototype.writeIntLE=function(e,t,i,s){if(e=+e,t=t>>>0,!s){const m=Math.pow(2,8*i-1);R(this,e,t,i,m-1,-m)}let h=0,l=1,w=0;for(this[t]=e&255;++h<i&&(l*=256);)e<0&&w===0&&this[t+h-1]!==0&&(w=1),this[t+h]=(e/l>>0)-w&255;return t+i},f.prototype.writeIntBE=function(e,t,i,s){if(e=+e,t=t>>>0,!s){const m=Math.pow(2,8*i-1);R(this,e,t,i,m-1,-m)}let h=i-1,l=1,w=0;for(this[t+h]=e&255;--h>=0&&(l*=256);)e<0&&w===0&&this[t+h+1]!==0&&(w=1),this[t+h]=(e/l>>0)-w&255;return t+i},f.prototype.writeInt8=function(e,t,i){return e=+e,t=t>>>0,i||R(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=e&255,t+1},f.prototype.writeInt16LE=function(e,t,i){return e=+e,t=t>>>0,i||R(this,e,t,2,32767,-32768),this[t]=e&255,this[t+1]=e>>>8,t+2},f.prototype.writeInt16BE=function(e,t,i){return e=+e,t=t>>>0,i||R(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=e&255,t+2},f.prototype.writeInt32LE=function(e,t,i){return e=+e,t=t>>>0,i||R(this,e,t,4,2147483647,-2147483648),this[t]=e&255,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},f.prototype.writeInt32BE=function(e,t,i){return e=+e,t=t>>>0,i||R(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=e&255,t+4},f.prototype.writeBigInt64LE=M(function(e,t=0){return pe(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),f.prototype.writeBigInt64BE=M(function(e,t=0){return ye(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function we(r,e,t,i,s,h){if(t+i>r.length)throw new RangeError("Index out of range");if(t<0)throw new RangeError("Index out of range")}function Be(r,e,t,i,s){return e=+e,t=t>>>0,s||we(r,e,t,4),o.write(r,e,t,i,23,4),t+4}f.prototype.writeFloatLE=function(e,t,i){return Be(this,e,t,!0,i)},f.prototype.writeFloatBE=function(e,t,i){return Be(this,e,t,!1,i)};function ge(r,e,t,i,s){return e=+e,t=t>>>0,s||we(r,e,t,8),o.write(r,e,t,i,52,8),t+8}f.prototype.writeDoubleLE=function(e,t,i){return ge(this,e,t,!0,i)},f.prototype.writeDoubleBE=function(e,t,i){return ge(this,e,t,!1,i)},f.prototype.copy=function(e,t,i,s){if(!L(e,Uint8Array))throw new TypeError("argument should be a Buffer");if(i||(i=0),!s&&s!==0&&(s=this.length),t>=e.length&&(t=e.length),t||(t=0),s>0&&s<i&&(s=i),s===i||e.length===0||this.length===0)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(i<0||i>=this.length)throw new RangeError("Index out of range");if(s<0)throw new RangeError("sourceEnd out of bounds");s>this.length&&(s=this.length),e.length-t<s-i&&(s=e.length-t+i);const h=s-i;return this===e&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(t,i,s):Uint8Array.prototype.set.call(e,this.subarray(i,s),t),h},f.prototype.fill=function(e,t,i,s){if(typeof e=="string"){if(typeof t=="string"?(s=t,t=0,i=this.length):typeof i=="string"&&(s=i,i=this.length),s!==void 0&&typeof s!="string")throw new TypeError("encoding must be a string");if(typeof s=="string"&&!f.isEncoding(s))throw new TypeError("Unknown encoding: "+s);if(e.length===1){const l=e.charCodeAt(0);(s==="utf8"&&l<128||s==="latin1")&&(e=l)}}else typeof e=="number"?e=e&255:typeof e=="boolean"&&(e=Number(e));if(t<0||this.length<t||this.length<i)throw new RangeError("Out of range index");if(i<=t)return this;t=t>>>0,i=i===void 0?this.length:i>>>0,e||(e=0);let h;if(typeof e=="number")for(h=t;h<i;++h)this[h]=e;else{const l=L(e,Uint8Array)?e:f.from(e,s),w=l.length;if(w===0)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(h=0;h<i-t;++h)this[h+t]=l[h%w]}return this};const G={};function se(r,e,t){function i(){const s=new t(e.apply(null,arguments));return Object.setPrototypeOf(s,i.prototype),s.code=r,s.name=`${s.name} [${r}]`,Error.captureStackTrace&&Error.captureStackTrace(s,i),s.stack,delete s.name,s}Object.setPrototypeOf(i.prototype,t.prototype),Object.setPrototypeOf(i,t),i.prototype.toString=function(){return`${this.name} [${r}]: ${this.message}`},G[r]=i}se("ERR_BUFFER_OUT_OF_BOUNDS",function(r){return r?`${r} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),se("ERR_INVALID_ARG_TYPE",function(r,e){return`The "${r}" argument must be of type number. Received type ${typeof e}`},TypeError),se("ERR_OUT_OF_RANGE",function(r,e,t){let i=`The value of "${r}" is out of range.`,s=t;return Number.isInteger(t)&&Math.abs(t)>2**32?s=be(String(t)):typeof t=="bigint"&&(s=String(t),(t>BigInt(2)**BigInt(32)||t<-(BigInt(2)**BigInt(32)))&&(s=be(s)),s+="n"),i+=` It must be ${e}. Received ${s}`,i},RangeError);function be(r){let e="",t=r.length;const i=r[0]==="-"?1:0;for(;t>=i+4;t-=3)e=`_${r.slice(t-3,t)}${e}`;return`${r.slice(0,t)}${e}`}function rt(r,e,t){z(e,"offset"),(r[e]===void 0||r[e+t]===void 0)&&V(e,r.length-(t+1))}function xe(r,e,t,i,s,h){if(r>t||r<e){const l=typeof e=="bigint"?"n":"";let w;throw e===0||e===BigInt(0)?w=`>= 0${l} and < 2${l} ** ${(h+1)*8}${l}`:w=`>= -(2${l} ** ${(h+1)*8-1}${l}) and < 2 ** ${(h+1)*8-1}${l}`,new G.ERR_OUT_OF_RANGE("value",w,r)}rt(i,s,h)}function z(r,e){if(typeof r!="number")throw new G.ERR_INVALID_ARG_TYPE(e,"number",r)}function V(r,e,t){throw Math.floor(r)!==r?(z(r,t),new G.ERR_OUT_OF_RANGE("offset","an integer",r)):e<0?new G.ERR_BUFFER_OUT_OF_BOUNDS:new G.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${e}`,r)}const it=/[^+/0-9A-Za-z-_]/g,Ie="+",me="/",Ee="-",Ae="_";function nt(r){return r.replaceAll(Ee,Ie).replaceAll(Ae,me)}function st(r){return r.replaceAll(Ie,Ee).replaceAll(me,Ae)}function ot(r){if(r=r.split("=")[0],r=r.trim().replace(it,""),r.length<2)return"";for(;r.length%4!==0;)r=r+"=";return r}function oe(r,e){e=e||1/0;let t;const i=r.length;let s=null;const h=[];for(let l=0;l<i;++l){if(t=r.charCodeAt(l),t>55295&&t<57344){if(!s){if(t>56319){(e-=3)>-1&&h.push(239,191,189);continue}else if(l+1===i){(e-=3)>-1&&h.push(239,191,189);continue}s=t;continue}if(t<56320){(e-=3)>-1&&h.push(239,191,189),s=t;continue}t=(s-55296<<10|t-56320)+65536}else s&&(e-=3)>-1&&h.push(239,191,189);if(s=null,t<128){if((e-=1)<0)break;h.push(t)}else if(t<2048){if((e-=2)<0)break;h.push(t>>6|192,t&63|128)}else if(t<65536){if((e-=3)<0)break;h.push(t>>12|224,t>>6&63|128,t&63|128)}else if(t<1114112){if((e-=4)<0)break;h.push(t>>18|240,t>>12&63|128,t>>6&63|128,t&63|128)}else throw new Error("Invalid code point")}return h}function ft(r){const e=[];for(let t=0;t<r.length;++t)e.push(r.charCodeAt(t)&255);return e}function ut(r,e){let t,i,s;const h=[];for(let l=0;l<r.length&&!((e-=2)<0);++l)t=r.charCodeAt(l),i=t>>8,s=t%256,h.push(s),h.push(i);return h}function _e(r){return n.toByteArray(ot(r))}function Z(r,e,t,i){let s;for(s=0;s<i&&!(s+t>=e.length||s>=r.length);++s)e[s+t]=r[s];return s}function L(r,e){return r instanceof e||r!=null&&r.constructor!=null&&r.constructor.name!=null&&r.constructor.name===e.name||e===Uint8Array&&f.isBuffer(r)}function Fe(r){return r!==r}const ht=function(){const r="0123456789abcdef",e=new Array(256);for(let t=0;t<16;++t){const i=t*16;for(let s=0;s<16;++s)e[i+s]=r[t]+r[s]}return e}(),Se=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,-1,-1,-1,-1,-1,-1,-1,10,11,12,13,14,15,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,11,12,13,14,15,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1];function M(r){return typeof BigInt>"u"?at:r}function at(){throw new Error("BigInt not supported")}})(X);class Oe{constructor(){B(this,"buffer",new Uint8Array(0))}write(n){let o=new Uint8Array(this.buffer.length+n.length);o.set(this.buffer),o.set(n,this.buffer.length),this.buffer=o}}class qe{constructor(n,o=1){B(this,"pendingByte",BigInt(0));B(this,"pendingBits",0);B(this,"buffer");B(this,"bufferedBytes",0);B(this,"_offset",0);this.stream=n,this.bufferSize=o,this.buffer=new Uint8Array(o)}get offset(){return this._offset}get byteOffset(){return this.pendingBits}end(){this.finishByte(),this.flush()}reset(){this._offset=0}finishByte(){this.pendingBits>0&&(this.buffer[this.bufferedBytes++]=Number(this.pendingByte),this.pendingBits=0,this.pendingByte=BigInt(0))}flush(){this.bufferedBytes>0&&(this.stream.write(X.Buffer.from(this.buffer.slice(0,this.bufferedBytes))),this.bufferedBytes=0)}min(n,o){return n<o?n:o}write(n,o){if(o==null&&(o=0),o=Number(o),Number.isNaN(o))throw new Error(`Cannot write to bitstream: Value ${o} is not a number`);if(!Number.isFinite(o))throw new Error(`Cannot write to bitstream: Value ${o} must be finite`);let u=BigInt(o%Math.pow(2,n)),a=n;for(;a>0;){let c=BigInt(8-this.pendingBits-a),d=c>=0?u<<c:u>>-c,y=Number(c>=0?a:this.min(-c,BigInt(8-this.pendingBits)));this.pendingByte=this.pendingByte|d,this.pendingBits+=y,this._offset+=y,a-=y,u=u%BigInt(Math.pow(2,a)),this.pendingBits===8&&(this.finishByte(),this.bufferedBytes>=this.buffer.length&&this.flush())}}}let J;class Pe{constructor(){B(this,"buffers",[]);B(this,"bufferedLength",0);B(this,"blockedRequest",null);B(this,"_offsetIntoBuffer",0);B(this,"_bufferIndex",0);B(this,"_offset",0);B(this,"_spentBufferSize",0);B(this,"retainBuffers",!1);B(this,"textDecoder",new TextDecoder);B(this,"skippedLength",0);B(this,"_ended",!1)}get bufferIndex(){return this._bufferIndex}get offset(){return this._offset}get spentBufferSize(){return this._spentBufferSize}set offset(n){if(n<this._spentBufferSize)throw new Error(`Offset ${n} points into a discarded buffer! If you need to seek backwards outside the current buffer, make sure to set retainBuffers=true`);let o=n-this._spentBufferSize,u=0;for(let a=0,c=this.buffers.length;a<c;++a){let d=this.buffers[a],y=d.length*8;if(o<y){this._bufferIndex=u,this._offset=n,this._offsetIntoBuffer=o,this.bufferedLength=d.length*8-this._offsetIntoBuffer;for(let f=a+1;f<c;++f)this.bufferedLength+=this.buffers[f].length*8;return}o-=y,++u}}simulateSync(n){let o=this.retainBuffers,u=this.offset;this.retainBuffers=!0;try{return n()}finally{this.retainBuffers=o,this.offset=u}}async simulate(n){let o=this.retainBuffers,u=this.offset;this.retainBuffers=!0;try{return await n()}finally{this.retainBuffers=o,this.offset=u}}clean(n){let o=n!==void 0?Math.min(n,this._bufferIndex):this._bufferIndex;for(let u=0,a=o;u<a;++u)this._spentBufferSize+=this.buffers[0].length*8,this.buffers.shift();this._bufferIndex-=o}get available(){return this.bufferedLength-this.skippedLength}isAvailable(n){return this.bufferedLength>=n}ensureNoReadPending(){if(this.blockedRequest)throw new Error("Only one read() can be outstanding at a time.")}async readString(n,o){return this.ensureNoReadPending(),await this.assure(8*n),this.readStringSync(n,o)}readStringSync(n,o){o||(o={}),this.ensureNoReadPending();let u=new Uint8Array(n),a=-1,c=1,d=o.encoding??"utf-8";["utf16le","ucs-2","ucs2"].includes(d)&&(c=2);for(let y=0,f=n;y<f;++y)u[y]=this.readSync(8);for(let y=0,f=n;y<f;y+=c){let x=u[y];if(c===2&&(x=x<<8|(u[y+1]??0)),x===0){a=y;break}}if(o.nullTerminated!==!1&&a>=0&&(u=u.subarray(0,a)),d==="utf-8")return this.textDecoder.decode(u);if(typeof Buffer>"u")throw new Error(`Encoding '${d}' is not supported: No Node.js Buffer implementation and TextDecoder only supports utf-8`);return Buffer.from(u).toString(d)}peekSync(n){return this.readCoreSync(n,!1)}skip(n){this.skippedLength+=n}readSync(n){return this.readCoreSync(n,!0)}*readBytes(n,o=0,u){var c;if(u??(u=n.length-o),this._offsetIntoBuffer%8===0){globalThis.BITSTREAM_TRACE&&(console.log(`------------------------------------------------------------    Byte-aligned readBytes(), length=${u}`),console.log(`------------------------------------------------------------    readBytes(): Pre-operation: buffered=${this.bufferedLength} bits, bufferIndex=${this._bufferIndex}, bufferOffset=${this._offsetIntoBuffer}, bufferLength=${((c=this.buffers[this._bufferIndex])==null?void 0:c.length)||"<none>"} bufferCount=${this.buffers.length}`));let d=u,y=0;for(;d>0;){this.available<d*8&&(yield Math.max((d*8-this.available)/8));let f=Math.floor(this._offsetIntoBuffer/8),x=this.buffers[this._bufferIndex],b=Math.min(d,x.length);for(let E=0;E<b;++E)n[y+E]=x[f+E];y+=b;let I=b*8;this.consume(I),d-=I,globalThis.BITSTREAM_TRACE&&(console.log(`------------------------------------------------------------    readBytes(): consumed=${b} bytes, remaining=${d}`),console.log(`------------------------------------------------------------    readBytes(): buffered=${this.bufferedLength} bits, bufferIndex=${this._bufferIndex}, bufferOffset=${this._offsetIntoBuffer}, bufferCount=${this.buffers.length}`))}}else for(let d=o,y=Math.min(n.length,o+u);d<y;++d)this.isAvailable(8)||(yield y-d),n[d]=this.readSync(8);return n}readBytesSync(n,o=0,u){u??(u=n.length-o);let a=this.readBytes(n,o,u);for(;;){if(a.next().done===!1)throw new Error(`underrun: Not enough bits are available (requested ${u} bytes)`);break}return n}async readBytesBlocking(n,o=0,u){u??(u=n.length-o);let a=this.readBytes(n,o,u);for(;;){let c=a.next();if(c.done===!1)await this.assure(c.value*8);else break}return n}readSignedSync(n){const o=this.readSync(n),u=2**(n-1),a=u-1;return o&u?-((~(o-1)&a)>>>0):o}maskOf(n){if(!J){J=new Map;for(let o=0;o<=64;++o)J.set(o,Math.pow(2,o)-1)}return J.get(n)??Math.pow(2,n)-1}readFloatSync(n){if(n!==32&&n!==64)throw new TypeError(`Invalid length (${n} bits) Only 4-byte (32 bit / single-precision) and 8-byte (64 bit / double-precision) IEEE 754 values are supported`);if(!this.isAvailable(n))throw new Error(`underrun: Not enough bits are available (requested=${n}, available=${this.bufferedLength}, buffers=${this.buffers.length})`);let o=new ArrayBuffer(n/8),u=new DataView(o);for(let a=0,c=o.byteLength;a<c;++a)u.setUint8(a,this.readSync(8));if(n===32)return u.getFloat32(0,!1);if(n===64)return u.getFloat64(0,!1);throw new TypeError(`Invalid length (${n} bits) Only 4-byte (32 bit / single-precision) and 8-byte (64 bit / double-precision) IEEE 754 values are supported`)}readByteAligned(n){let o=this.buffers[this._bufferIndex],u=o[this._offsetIntoBuffer/8];return n&&(this.bufferedLength-=8,this._offsetIntoBuffer+=8,this._offset+=8,this._offsetIntoBuffer>=o.length*8&&(this._bufferIndex+=1,this._offsetIntoBuffer=0,this.retainBuffers||this.clean())),u}consume(n){this.bufferedLength-=n,this._offsetIntoBuffer+=n,this._offset+=n;let o=this.buffers[this._bufferIndex];for(;o&&this._offsetIntoBuffer>=o.length*8;)this._bufferIndex+=1,this._offsetIntoBuffer-=o.length*8,o=this.buffers[this._bufferIndex],this.retainBuffers||this.clean()}readShortByteAligned(n,o){let u=this.buffers[this._bufferIndex],a=this._offsetIntoBuffer/8,c=u[a],d;if(a+1>=u.length?d=this.buffers[this._bufferIndex+1][0]:d=u[a+1],n&&this.consume(16),o==="lsb"){let y=c;c=d,d=y}return c<<8|d}readLongByteAligned(n,o){let u=this._bufferIndex,a=this.buffers[u],c=this._offsetIntoBuffer/8,d=a[c++];c>=a.length&&(a=this.buffers[++u],c=0);let y=a[c++];c>=a.length&&(a=this.buffers[++u],c=0);let f=a[c++];c>=a.length&&(a=this.buffers[++u],c=0);let x=a[c++];c>=a.length&&(a=this.buffers[++u],c=0),n&&this.consume(32);let b=(d&128)!==0;if(d&=-129,o==="lsb"){let E=x,S=f,F=y,O=d;d=E,y=S,f=F,x=O}let I=d<<24|y<<16|f<<8|x;return b&&(I+=2**31),I}read3ByteAligned(n,o){let u=this._bufferIndex,a=this.buffers[u],c=this._offsetIntoBuffer/8,d=a[c++];c>=a.length&&(a=this.buffers[++u],c=0);let y=a[c++];c>=a.length&&(a=this.buffers[++u],c=0);let f=a[c++];if(c>=a.length&&(a=this.buffers[++u],c=0),n&&this.consume(24),o==="lsb"){let x=d;d=f,f=x}return d<<16|y<<8|f}readPartialByte(n,o){let a=this.buffers[this._bufferIndex][Math.floor(this._offsetIntoBuffer/8)],c=this._offsetIntoBuffer%8|0;return o&&this.consume(n),a>>8-n-c&this.maskOf(n)|0}readCoreSync(n,o,u="msb"){if(this.ensureNoReadPending(),this.available<n)throw new Error(`underrun: Not enough bits are available (requested=${n}, available=${this.bufferedLength}, buffers=${this.buffers.length})`);this.adjustSkip();let a=this._offsetIntoBuffer%8;if(a===0){if(n===8)return this.readByteAligned(o);if(n===16)return this.readShortByteAligned(o,u);if(n===24)return this.read3ByteAligned(o,u);if(n===32)return this.readLongByteAligned(o,u)}if(n<8&&(8-a|0)>=n)return this.readPartialByte(n,o);let c=n,d=this._offsetIntoBuffer,y=this._bufferIndex,f=BigInt(0),x=0,b=n>31;for(;c>0;){if(y>=this.buffers.length)throw new Error(`Internal error: Buffer index out of range (index=${y}, count=${this.buffers.length}), offset=${this.offset}, readLength=${n}, available=${this.available})`);let I=this.buffers[y],E=Math.floor(d/8);if(E>=I.length)throw new Error(`Internal error: Current buffer (index ${y}) has length ${I.length} but our position within the buffer is ${E}! offset=${this.offset}, bufs=${this.buffers.length}`);let S=d%8,F,O=I[E];F=Math.min(8-S,c),b?f=f<<BigInt(F)|BigInt(I[E])>>BigInt(8)-BigInt(F)-BigInt(S)&BigInt(this.maskOf(F)):x=x<<F|O>>8-F-S&this.maskOf(F),d+=F,c-=F|0,d>=I.length*8&&(y+=1,d=0)}return o&&this.consume(n),b?Number(f):x}adjustSkip(){if(!(this.skippedLength<=0)){for(;this.buffers&&this.skippedLength>this.buffers[0].length*8-this._offsetIntoBuffer;)this.skippedLength-=this.buffers[0].length*8-this._offsetIntoBuffer,this._offsetIntoBuffer=0,this.buffers.shift();this.buffers.length>0&&(this._offsetIntoBuffer+=this.skippedLength,this.skippedLength=0)}}assure(n,o=!1){return this.ensureNoReadPending(),this.bufferedLength>=n?Promise.resolve():this.block({length:n,assure:!0}).then(u=>{if(u<n&&!o)throw this.endOfStreamError(n)})}read(n){return this.ensureNoReadPending(),this.available>=n?Promise.resolve(this.readSync(n)):this.block({length:n})}readSigned(n){return this.ensureNoReadPending(),this.available>=n?Promise.resolve(this.readSignedSync(n)):this.block({length:n,signed:!0})}block(n){return this._ended?n.assure?Promise.resolve(this.available):Promise.reject(this.endOfStreamError(n.length)):(this.blockedRequest={...n,...this.promise()},this.blockedRequest.promise)}readFloat(n){return this.ensureNoReadPending(),this.available>=n?Promise.resolve(this.readFloatSync(n)):this.block({length:n,float:!0})}async peek(n){return await this.assure(n),this.peekSync(n)}addBuffer(n){if(this._ended)throw new Error("Cannot add buffers to a reader which has been marked as ended without calling reset() first");if(this.buffers.push(n),this.bufferedLength+=n.length*8,this.blockedRequest&&this.blockedRequest.length<=this.available){let o=this.blockedRequest;this.blockedRequest=null,o.assure?o.resolve(o.length):o.signed?o.resolve(this.readSignedSync(o.length)):o.float?o.resolve(this.readFloatSync(o.length)):o.resolve(this.readSync(o.length))}}get ended(){return this._ended}reset(){if(this.blockedRequest)throw new Error("Cannot reset while there is a blocked request!");this.buffers=[],this.bufferedLength=0,this.blockedRequest=null,this._offsetIntoBuffer=0,this._bufferIndex=0,this._offset=0,this._spentBufferSize=0,this._ended=!1}end(){if(this._ended=!0,this.blockedRequest){let n=this.blockedRequest;if(this.blockedRequest=null,n.length<=this.available)throw new Error("Internal inconsistency in @/bitstream: Should have granted request prior. Please report this bug.");n.assure?n.resolve(this.available):n.reject(this.endOfStreamError(n.length))}}endOfStreamError(n){return new Error(`End of stream reached while reading ${n} bits, only ${this.available} bits are left in the stream`)}}function De(p){const o=p.split(`
`).flatMap(d=>{const y=d.trim().match(/^(\d+) (\w+)$/);return y&&parseInt(y[1],10)>0?[{quantity:parseInt(y[1],10),id:y[2]}]:[]}),u=new Oe,a=new qe(u,1024);return P.fromList(o).encode(a),a.end(),X.Buffer.concat([u.buffer]).toString("base64url")}function Ge(p){const n=X.Buffer.from(p,"base64url");let o=new Pe;return o.addBuffer(n),P.decode(o).asCardRefQty.map(c=>`${c.quantity} ${c.id}`).join(`
`)}k.decodeList=Ge,k.encodeList=De,Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})});